# Design

### Features I want to achieve
1. Login in with Google, Facebook & Local 
2. Have users to keep track of these information


#### Schemes for users 
```ts
@Scheme()
User {
  _id: string;
  authTyep: string; // it could be google, facebook or other third party that allows OAuth2.0
}


```


### Problems I met
##### Task 1: If a user signin with google, facebook... how to store in database ?
Problems:
1. Facebook id and google id maybe the same, it will collision
2. How do I find a user in db if a user has already signin with google 

Thoughts:
1. When user signin, I only has OAuth type(e.g google) and its id
2. Mongo autogenerated **_id** is unique, but how it relate with OAuth type and id
3. When a Google user signin, I first want to find it in my db, at the time I only have
googleid and I know it is from google, so first I can go to Google DB, and try to find the 
User.
4. But it will be complicated, because later on I may have Meta DB, TwitterDB...
5. So I only want one type of user, the user contains information about its authtype and id
6. Now I have a user, has **_id** (Mongo id), **authtype**(google, meta, github..), **thirdParty_id**
so one authType can't have two same ids, so this structure of User makes sure it will not cause collision
, because I can find a user through authType and id, it will guarantee to give me a unique user

#### Task2: How to authorize users to access data?
Problems:
1. Now user can signin with OAuth, and they have a accessToken, how to disable user without accessToken to fetch data?
2. Users with correct JWT token can fetch data now, but how to allow user to fetch their only data? 

Thoughts:
1. Create middleware to extract jwt token from the user, and check the 
JWT secret, if it matches, then it can fetch data.
2. JWT contains a user id, JWT token is bonding with a specific user, so
REST Api will check the JWT token user id, and use this id to fetch this own data. This method makes sure two things, first is it verifies the JWT token for authentiaction, and JWT userid for authorization for fethcing specific data.

#### Tasks3. How to connect the relationships between user and todos
Where to post the todo?
- It must be down by the user, because only the user has the right to make the todo
- So it is like an article and author, the todo must have a user id and it depends on the front end to solve this problem.

 